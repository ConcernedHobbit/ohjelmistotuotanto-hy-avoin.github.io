<!DOCTYPE html>
<html lang="en">

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Viikko 1</title>
  <meta name="description" content="">

  <link rel="stylesheet" href="/assets/main.css">
  <link rel="canonical" href="http://localhost:4000/tehtavat1/">
  <link rel="alternate" type="application/rss+xml" title="Ohjelmistotuotanto avoin yliopisto 2020" href="/feed.xml">

  
</head>


  <body>
    
    <header class="site-header" role="banner">

  <div class="wrapper">
    
    
    <a class="site-title" href="/">Ohjelmistotuotanto avoin yliopisto 2020</a>
    
    
      <nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
              <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
              <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger">
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
            <a class="page-link" href="/osa0/">Osa 0</a>
            
          
            
            
            <a class="page-link" href="/osa1/">Osa 1</a>
            
          
            
            
            <a class="page-link" href="/osa2/">Osa 2</a>
            
          
            
            
            <a class="page-link" href="/osa3/">Osa 3</a>
            
          
            
            
            <a class="page-link" href="/osa4/">Osa 4</a>
            
          
            
            
            <a class="page-link" href="/osa5/">Osa 5</a>
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
            <a class="page-link" href="/tehtavat/">Tehtävät</a>
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
          
        </div>
      </nav>
    

    
  </div>
</header>


    <main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post">

  <header class="post-header">
    <h1 class="post-title"></h1>
  </header>

  <div class="post-content">
    <h2 id="viikko-1">Viikko 1</h2>

<p>Tämän viikon tehtävissä harjoitellaan ensin muutaman tärkeän ohjelmistokehityksen työkalun (<em>komentorivi, versionhallinta, buildin hallinta, automatisoitu testaus, jatkuva integraatio</em>) käyttöä.</p>

<p>Laskarien lopuksi harjoitellaan <em>riippuvuuksien injektointia</em> joka on melko simppeli mutta erittäin käyttökelpoinen tekniikka, jonka avulla sovellusten testattavuutta on mahdollista parantaa.</p>

<h3 id="typoja-tai-epäselvyyksiä-tehtävissä">Typoja tai epäselvyyksiä tehtävissä?</h3>

<p>Tee <a href="/osa0#typoja-materiaalissa">korjausehdotus</a> editoimalla <a href="https://github.com/ohjelmistotuotanto-hy/ohjelmistotuotanto-hy.github.io/blob/master/tehtavat1.md">tätä</a> tiedostoa GitHubissa.</p>

<h3 id="tehtävien-palauttaminen">Tehtävien palauttaminen</h3>

<p>Tehtävien palauttamiseen tarvitset Helsingin yliopiston käyttäjätunnuksen. Ohje tunnuksen aktivoimiseen <a href="https://www.helsinki.fi/fi/avoin-yliopisto/opiskelu/opinnoissa-alkuun/helsingin-yliopiston-kayttajatunnus">täällä</a>. Huomaa, että aktivoiminen onnistuu vasta ilmoittautumista seuraavana päivänä.</p>

<p>Tehtävät palautetaan GitHubiin, sekä merkitsemällä tehdyt tehtävät palautussovellukseen <a href="https://study.cs.helsinki.fi/stats/courses/ohtu-avoin-2020">https://study.cs.helsinki.fi/stats/courses/ohtu-avoin-2020</a>. Käytännössä tällä viikolla tehdään palautusta varten kaksi erillistä GitHub-repositoria, ensimmäinen tehtäviä 2-13 varten ja toinen tehtäviä 14-16 varten. Jos et vielä tiedä mikä on GitHub ja repositorio, niin pian opit.</p>

<p>Tehtävää 1 ei varsinaisesti palauteta minnekään.</p>

<h3 id="1-komentorivi">1. komentorivi</h3>

<p>Graafisten käyttöliittymien olemassaolosta huolimatta ohjelmistoalalla on edelleen erittäin tärkeää hallita komentorivin eli terminaalin käyttö. Itse asiassa komentorivin merkitys on jopa nousussa.</p>

<p>Varmista, että osaat käyttää “riittävästi” komentoriviä (ks. alla oleva lista).</p>

<p>Jos osaamisessasi on puutteita (ks. alla oleva lista) kertaa haluamastasi resurssista:</p>

<ul>
  <li><a href="https://www.codecademy.com/learn/learn-the-command-line">https://www.codecademy.com/learn/learn-the-command-line</a> online-kurssin kaksi ensimmäistä osaa <em>Navigating the File System</em> ja <em>Viewing and Changing the File System</em></li>
  <li><a href="https://ryanstutorials.net/linuxtutorial/">https://ryanstutorials.net/linuxtutorial/</a> oppaasta 4 osaa: <em>1. The Command Line</em>, <em>2. Basic Navigation</em>, <em>3.More About Files</em> ja <em>5. File Manipulation</em></li>
</ul>

<p>Myös kurssin Tietokone työvälineenä tämän syksyn <a href="https://tkt-lapio.github.io/command-line/">komentorivimateriaali</a> käsittelee myös suurta osaa tehtävän komennoista.</p>

<p><em>HUOM. Codecademy vaatii kirjautumisen Facebook, Google tai GitHub -tunnuksella. Kurssilla käytetään muutenkin GitHubia, eli se tunnus pitäisi kaikilla olla olemassa, jotta pääsee kirjautumaan.</em></p>

<p>Tämän tehtävän jälkeen sinun tulisi hallita seuraavat asiat:</p>
<ul>
  <li>käsitteet
    <ul>
      <li>root directory</li>
      <li>home directory</li>
      <li>parent directory</li>
      <li>child directory</li>
      <li>working directory</li>
      <li>.. ja *</li>
    </ul>
  </li>
  <li>ja osata käyttää komentoja
    <ul>
      <li>pwd</li>
      <li>cd</li>
      <li>ls, ls -a, ls -l, ls -t</li>
      <li>mkdir</li>
      <li>touch</li>
      <li>cp</li>
      <li>rm, rm -r</li>
      <li>mv</li>
    </ul>
  </li>
</ul>

<p>Tulet tarvitsemaan komentorivin käyttötaitoja tällä kurssilla ja muutenkin opinnoissasi.</p>

<p>Tehtävää ei palauteta mitenkään. Voit merkitä tehtävän tehdyksi kun osaat yllä luetellut asiat.</p>

<h3 id="2-githubiin-versionhallinta">2. Githubiin [versionhallinta]</h3>

<p>Jos sinulla ei jostain syystä ole vielä tunnusta <a href="https://github.com">GitHubiin</a>, luo se nyt.</p>

<p>Luo githubiin repositorio nimellä ohtu-2019-viikko1</p>

<ul>
  <li>klikkaa yläpalkin oikeassa reunassa olevaa  “Create a new repo”-ikonia</li>
  <li><strong>laita rasti</strong> kohtaan Initialize this repository with a README</li>
</ul>

<p><img src="http://localhost:4000/images/lh1-1.png" alt="" /></p>

<p><strong>Jos et ole vielä luonut</strong> koneellesi <em>ssh-avainta</em>, tee se nyt</p>

<ul>
  <li>Ohje avaimen luomiseen esim. <a href="https://www.howtoforge.com/linux-basics-how-to-install-ssh-keys-on-the-shell">täällä</a>. Riittää että teet stepit 1 ja 2 tai kurssin <a href="https://github.com/mluukkai/ohjelmistotekniikka-syksy-2019/blob/master/tehtavat/viikko1.md#julkinen-avain">Ohjelmistotekniikka</a>-materiaalista</li>
</ul>

<p>Lisää julkinen avain githubiin:</p>

<ul>
  <li><a href="https://github.com/settings/ssh">https://github.com/settings/ssh</a></li>
</ul>

<p>Näin pystyt käyttämään GitHubia ilman salasanan syöttämistä koneelta, josta juuri luodun avaimen salainen pari löytyy</p>

<p>Jos et ole jo aiemmin niin tehnyt, konfiguroi nimesi ja email-osoitteesi paikallisen koneesi git:iin antamalla komennot:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git config --global user.name "Your Name"
git config --global user.email my.address@gmail.com
</code></pre></div></div>

<p>Oletuseditoriksi kannattaa Linuxilla ja OSX:lla (eli Macillä) konfiguroida <em>nano</em></p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git config --global core.editor nano
</code></pre></div></div>

<p>ja Windowsilla  <em>notepad</em></p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git config --global core.editor notepad    
</code></pre></div></div>

<p>Tosin jos olet vimin käyttäjä, voit jättää edellisen tekemättä.</p>

<p>Kloonaa nyt githubiin tehty repositorio <strong>paikalliselle koneelle</strong>. Tämä tapahtuu antamalla komentoriviltä komento</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git clone git@github.com:omatunnustahan/ohtu-2019-viikko1.git
</code></pre></div></div>

<p>missä komennon <code>git clone</code> parametrina on repositoriosi sivulla näkyvä merkkijono (huomaa, että formaatin on oltava SSH):</p>

<p><img src="http://localhost:4000/images/lh1-2.png" alt="" /></p>

<p>Nyt paikalliselle koneellesi syntynyt hakemisto <code>ohtu-2019-viikko1</code> (hakemiston nimi on sama kuin repositoriosi), joka on on githubissa olevan repositorion klooni.</p>

<h3 id="3-gitin-alkeet-versionhallinta">3. Gitin alkeet [versionhallinta]</h3>

<p>Olet jo todennäköisesti käyttänyt Gitiä aiemmilla kursseilla. Tässä tehtävässä harjoitellaan seuraavia komentoja:</p>

<ul>
  <li>git add</li>
  <li>git commit</li>
  <li>git status</li>
  <li>git checkout – file</li>
  <li>git reset HEAD</li>
  <li>
    <p>.gitignore</p>
  </li>
  <li>Jos et vielä hallitse komentoja, käy läpi kurssin Ohjelmistotekniikka 
<a href="https://github.com/mluukkai/ohjelmistotekniikka-syksy-2019/blob/master/tehtavat/viikko1.md#gitin-alkeet">Git-tutoriaali</a>. Pelkän lukemisen sijaan kannattanee myös tehdä itse tutoriaalin git-operaatiot.</li>
</ul>

<p>Lisää git-ohjeita löytyy runsaasti internetistä, esim:</p>
<ul>
  <li><a href="http://git-scm.com/book">Pro Git -opas</a>, kannattaa lukea näin alkuun luku 2</li>
  <li><a href="https://help.github.com/articles/">Githubin helpit</a></li>
  <li><a href="https://www.atlassian.com/git/tutorials">https://www.atlassian.com/git/tutorials</a></li>
  <li><a href="https://we.riseup.net/debian/git-development-howto">https://we.riseup.net/debian/git-development-howto</a></li>
  <li><a href="http://www.ralfebert.de/tutorials/git/">http://www.ralfebert.de/tutorials/git/</a></li>
</ul>

<p><strong>Tee nyt seuraavat:</strong></p>

<ul>
  <li>mene edellisessä tehtävässä luotuun repositorion klooniin (eli komennon <code>git clone</code> luomaan hakemistoon)</li>
  <li>lisää ja committaa repositorioon kaksi tiedostoa ja kaksi hakemistoa, joiden sisällä on tiedostoja
    <ul>
      <li>muista hyödyllinen komento git status</li>
    </ul>
  </li>
  <li>muuta ainakin kahden tiedoston sisältöä ja committaa muutokset repositorioon</li>
  <li>tee .gitignore-tiedosto, jossa määrittelet, että repositorion juurihakemistossa olevat tiedostot, joiden pääte on <em>tmp</em> ja hakemistot joiden nimi on <em>build</em> ja <em>.gradle</em> ignoroidaan
    <ul>
      <li>huomaa, että ainoastaan hakemisto nimeltä <em>build</em> pitää ignoroida, tiedostot joiden nimi alkaa sanalla build, esim tehtävässä 7 lisättävä <em>build.gradle</em> eivät saa ignoroitua!</li>
      <li>toinen ignorattava hakemisto on siis <em>.gradle</em>, jonka nimi alkaa pisteellä</li>
      <li>pistealkuiset hakemistot ja tiedostot eivät näy oletusarvoisesti komennon <em>ls</em> listauksissa, saat ne näkyville komennolla <em>ls -a</em></li>
    </ul>
  </li>
  <li>lisää tmp-päätteisiä tiedostoja hakemistoon ja varmista että git jättää ne huomioimatta
    <ul>
      <li>saat asian tarkastettua komennolla <em>git status</em></li>
    </ul>
  </li>
  <li>lisää myös hakemisto nimeltä <em>build</em>  ja hakemiston sisälle joku tiedosto. Varmista että build sisältöineen ei mene versionhallinnan alaisuuteen</li>
  <li>lisää ja commitoi .gitignore repositorioosi</li>
  <li>tee muutos johonkin tiedostoon. Älä lisää tiedostoa “staging”-alueelle
    <ul>
      <li>peru muutos (git status -komento antaa vihjeen miten tämä tapahtuu)</li>
    </ul>
  </li>
  <li>tee muutos ja lisää tiedosto “staging”-alueelle
    <ul>
      <li>peru muutos (git status -komento antaa vihjeen miten tämä tapahtuu)</li>
    </ul>
  </li>
</ul>

<p><strong>git add -p</strong></p>

<ul>
  <li>tutoriaaleissa ei valitettavasti käytetä git add -komennon hyödyllistä muotoa <code>git add -p</code></li>
  <li>tee muutoksia muutamiin tiedostoihin ja lisää muutokset staging-alueelle komennon git add -p avulla</li>
  <li>jos lisäät projektiin uusia tiedostoja, ei git add -p huomaa niitä, eli ne on lisättävä staging-alueelle erikseen</li>
  <li><em>käytä jatkossa komentoa git add -p aina kun se on suinkin mahdollista!</em></li>
</ul>

<p>komennolla man git add saat lisätietoa optiosta ja mm. vastausvaihtoehtojen selitykset.</p>

<h3 id="4-tiedostojen-lisääminen-githubiin-versionhallinta">4. Tiedostojen lisääminen GitHubiin [versionhallinta]</h3>

<p>Tehtävässä 2 tehtiin GitHubiin repositorio, joka liitettiin paikalliselle koneelle luotuun repositorioon “remote repositoryksi”. Synkronoidaan paikallisen repositorion ja githubin tilanne:</p>

<ul>
  <li>“pushaa” nämä GitHubissa olevaan etärepositorioon antamalla komento <code>git push</code></li>
  <li>varmista selaimella, että lisätyt tiedostot menevät GitHubiin</li>
</ul>

<p>Githubissa pitäisi näyttää suunilleen seuraavalta</p>

<p><img src="http://localhost:4000/images/lh1-3.png" alt="" /></p>

<h3 id="5-monta-kloonia-samasta-repositoriosta-versionhallinta">5. Monta kloonia samasta repositoriosta [versionhallinta]</h3>

<p>Yleensä on tapana pitää GitHubissa olevaa repositorioa tiedostojen “keskitettynä” sijoituspaikkana ja liittää paikallisella koneella oleva repositorio GitHubissa olevan repositorion etärepositorioksi, kuten teimme tehtävässä 1.</p>

<p>Jos työskennellään useammalta koneelta, on githubissa olevasta repositoriosta monta kloonia ja kloonien tila on pidettävä ajantasalla.</p>

<p>Luodaan nyt harjoituksen vuoksi paikalliselle koneelle repositoriosta toinen klooni:</p>

<ul>
  <li>mene komentoriville ja esim. kotihakemistoosi  (tai johonkin paikkaan, joka ei ole git-repositorio)</li>
  <li>anna komento <code class="highlighter-rouge">git clone git@github.com:githubtunnus/repositorionNimi.git nimiKloonille</code>
    <ul>
      <li>githubtunnus ja repositorionNimi selviävät  GitHubista repositoriosi tehtävän 2 toisen kuvan osoittamasta paikasta</li>
      <li><em>nimiKloonille</em> tulee olemaan kloonatun repositorion nimi, varmista että annat nimen, jonka nimistä tiedostoa tai hakemistoa ei jo ole kansiossa</li>
    </ul>
  </li>
  <li>mene kloonattuun repositorioon ja lisää sinne jotain tiedostoja. Committaa lopuksi</li>
  <li>“pushaa” muutokset GitHubiin</li>
  <li>varmista selaimella, että lisätyt tiedostot menevät GitHubiin</li>
</ul>

<p><strong>Mene nyt tehtävässä 1 tehtyyn GitHub-repositorion klooniin.</strong></p>

<ul>
  <li>alkuperäinen paikallinen klooni ei ole enää ajantasalla, “pullaa” sinne muutokset komennolla <code>git pull</code></li>
  <li>varmista että molempien paikallisten repositorioiden sisältö on nyt sama</li>
  <li>lisää alkuperäiseen kopioon joitain tiedostoja ja pushaa ne GitHubiin</li>
  <li>mene jälleen kloonattuun kopioon ja pullaa</li>
</ul>

<h3 id="6-repositorion-siivous-versionhallinta">6 Repositorion siivous [versionhallinta]</h3>

<p>Valmistaudutaan seuraavaan tehtävään siivoamalla repositoriostamme ylimääräiset tiedostot</p>

<ul>
  <li>mene repositoriosi alkuperäiseen, tehtävässä 2 tekemääsi klooniin
    <ul>
      <li>voit poistaa tehtävää 5 varten tekemäsi harjoituskloonin</li>
    </ul>
  </li>
  <li>poista repositorioistasi kaikki hakemistot sekä muut tiedostot paitsi <em>.gitignore</em> ja <em>README.md</em></li>
  <li>committaa muutokset
    <ul>
      <li>varmista komennolla <em>git status</em> että kaikki muutokset ovat versionhallinnassa, eli että git ei ilmoita joidenkin tiedostojen olevan <em>Changes not staged for commit</em></li>
      <li>joudut ehkä kertaamaan tehtävän 3 linkittämistä tutoriaaleista sitä miten tiedostojen poistaminen gitistä tapahtuu</li>
    </ul>
  </li>
  <li>pushaa muutokset githubiin. Katso selaimella, että GitHubissa kaikki on ajan tasalla, eli että repositiossa ei ole mitään muuta kuin tiedostot <em>.gitignore</em> ja <em>README.md</em></li>
</ul>

<p>Haetaan sitten seuraavissa tehtävissä käytettävä koodi</p>

<ul>
  <li>hae osoitteesta <a href="https://github.com/ohjelmistotuotanto-hy/syksy2019/blob/master/ohtuvarasto.zip?raw=true">https://github.com/ohjelmistotuotanto-hy/syksy2019/blob/master/ohtuvarasto.zip?raw=true</a> löytyvä zipattu paketti</li>
  <li>pura paketti sopivaan paikkaan</li>
  <li>
    <p>siirrä paketin sisällä olevat tiedostot kloonattuun repositorioon siten, että <strong>paketissa olevat tiedostot ja hakemistot tulevat repositorion juureen</strong></p>
  </li>
  <li>repositoriosi sisältävän hakemiston tulee nyt näyttää seuraavalta</li>
</ul>

<p><img src="http://localhost:4000/images/lh1-4.png" alt="" /></p>

<ul>
  <li>lisää ja committoi zipistä puretut tavarat repositorioosi ja pushaa ne githubiin</li>
  <li>katso vielä kerran selaimella, että GitHubissa kaikki on ajan tasalla</li>
</ul>

<p><strong>Huomaa, että repositoriosi tulee näyttää tehtävän jälkeen suunnilleen seuraavalta:</strong></p>

<p><img src="http://localhost:4000/images/lh1-5.png" alt="" /></p>

<p><strong>Jos hakemisto <em>src</em> ja tiedostot <em>build.gradle</em> ym. eivät ole repositorion juuressa, siirrä ne sinne ennen kuin siirryt eteenpäin.</strong></p>

<h3 id="7-gradle">7. Gradle</h3>

<p>Ohjelmoinnin peruskursseilla koodi suoritettiin painamalla NetBeansin “vihreää nuolta”, ja testit painamalla “mustaa silmää”. Ammattimaisessa ohjelmistokehityksessä koodin suorituskelpoiseksi tekemisen ja testaamisen on tapahduttava toistettavalla tavalla, ja siten että operaatiot pystytään suorittamaan millä tahasa koneella, <em>skriptatusti</em> komentoriviltä, eli riippumatta NetBeansin kaltaisista kehitysympäristöistä.</p>

<p>Tähän tarkoitukseen on kehitetty useita <em>build-ohjelmistoja</em>. Olet ehkä käyttänyt aikaisemmilla kursseilla <a href="https://maven.apache.org/">Mavenia</a>. Tällä kurssilla käytetään <a href="https://gradle.org">Gradlea</a>, joka on uusissa projekteissa paljolti korvannut Mavenin. Se on Mavenia helpommin konfiguroitava, ja joissain tilanteissa myös tätä nopeampi.</p>

<p>Gradlen dokumentaatio sisältää seuraavan kuvauksen:</p>

<blockquote>
  <p>Gradle is a build tool with a focus on build automation and support for multi-language development. If you are building, testing, publishing, and deploying software on any platform, Gradle offers a flexible model that can support the entire development lifecycle from compiling and packaging code to publishing web sites. Gradle has been designed to support build automation across multiple languages and platforms including Java, Scala, Android, C/C++, and Groovy, and is closely integrated with development tools and continuous integration servers including Eclipse, IntelliJ, and Jenkins.</p>
</blockquote>

<ul>
  <li>edellisessä tehtävässä lisättiin repositorioon gradle-muodossa oleva projekti, joka sisältää aikoinaan <a href="http://www.cs.helsinki.fi/u/wikla/ohjelmointi/materiaali/02_oliot/#15">ohjelmoinnin perusteissa</a> olleen luokan <code>Varasto</code>, sen käyttöä demonstroivan pääohjelman ja muutaman JUnit-testin</li>
  <li>tutki gradle-muotoisen projektin hakemistorakennetta esim. antamalla komento <code>tree</code> projektin sisältävän hakemiston juuressa (<em>tree</em> ei ole gradleen liittyvä käsky vaan normaali shell-komento)
    <ul>
      <li>Windowsissa komennosta käyttökelpoisin muoto on <code>tree /F</code>
  * Jos käytössäsi on Windowsissa <em>git bash</em> komento on muotoa <code>cmd //c tree</code></li>
      <li>HUOM: OSX:ssä ei ole oletusarvoisesti tree-komentoa</li>
      <li>mikäli koneellasi on <a href="http://mxcl.github.com/homebrew/">HomeBrew</a> asennettuna, saat tree:n asennettua <code>brew install tree</code></li>
      <li>myöskään kaikissa linuxeissa ei komento <em>tree</em> ole  oletusarvoisesti asennettu. debian-pohjaisissa linuxeissa (esim ubuntussa) saat asennettua tree:n komennolla <code>sudo apt-get install tree</code></li>
    </ul>
  </li>
  <li>tarkastele projektin määrittelevän tiedoston <em>build.gradle</em> sisältöä
    <ul>
      <li>tiedosto määrittelee mm. pääohjelman sijainnin <code class="highlighter-rouge">mainClassName = 'ohtu.ohtuvarasto.Main'</code></li>
    </ul>
  </li>
</ul>

<p><strong>Avaa edellisen tehtävän projekti suosikki-idelläsi</strong></p>

<ul>
  <li>Huomaa, että NetBeans ei tue oletusarvoisesti Gradlea, ja joudut asentamaan gradle-pluginin valitsemalla <em>tools -&gt; plugins -&gt; available plugins</em>
    <ul>
      <li>Uudet versiot Eclipsestä ja IntelliJ IDEAsta osaavat avata Gradle-projekteja suoraan</li>
    </ul>
  </li>
  <li>HUOM: jos et ole aiemmin kääntänyt koneellasi gradle-muotoisia projekteja, saattaa IDE valittaa tässä vaiheessa joidenkin kirjastojen (mm. JUnit) puuttumisesta. Asia korjaantuu “buildaamalla” tai kääntämällä projekti komentoriviltä (ohjeet alla)</li>
</ul>

<p>Ohjelmakoodin editointi kannattaa tehdä IDE:llä kuten usein myös ohjelman ja testien ajaminenkin, mutta <strong>gradlea kannattaa kuitenkin ehdottomasti totutella käyttämään myös komentoriviltä.</strong></p>

<p><strong>Kokeillaan nyt gradlen käyttöä komentoriviltä</strong></p>

<p>Gradle on siinä mielessä mielenkiintoinen työkalu, että sitä ei ole pakko asentaa ennen käytön aloittamista. Gradle-projektit sisältävät skriptit <em>gradlew</em> (Linuxille) ja <em>gradlew.bat</em> (Windowsille), jotka osaavat tarvittaessa asentaa Gradlen koneellesi.</p>

<p>Suorita projektin juuressa (eli samassa hakemistossa missä tiedosto <em>build.gradle</em> sijaitsee) komento <code>./gradlew build</code> (Linux) <code>gradlew.bat build</code> (Windows). Gradle asentuu koneellesi. Jos edelliset komennot eivät toimi, kokeile komentoa <code>gradle build</code> joka näyttää toimivan ainakin laitoksen koneilla.</p>

<ul>
  <li><strong>HUOM</strong> OSX:llä (eli Macilla) automaattinen asentuminen ei ole ainakaan kaikilla toiminut. Eli OSX-käyttäjien kannattaa aloittaa asentamalla <em>gradle</em> [homebrew:illa](https://gradle.org/install#with-homebrew, ja suorittaa komento muodossa <code>gradle build</code>. Jos et jo käytä <a href="https://brew.sh">homebrewia</a>, kannattaa aloittaa nyt.</li>
</ul>

<p>Jos mikään yo. komennoista ei päädy ilmoitukseen <em>BUILD SUCCESSFUL</em> on todennäköisesti Javan konfiguraatiossa jotain häikkää. Koneellasi tulee olla <em>Java Development Kit</em> (eli JDK) asennettuna ja ympäristömuuttuja <em>JAVA_HOME</em> tulee olla asetettu siten, että sen arvona on JDK:n sijainti, ks. esim. <a href="http://www.robertsindall.co.uk/blog/setting-java-home-variable-in-windows/">http://www.robertsindall.co.uk/blog/setting-java-home-variable-in-windows/</a>. JAVA_PATH:in asettamisen jälkeen komentorivi tulee käynnistää uudelleen.</p>

<blockquote>
  <p>Jos saat JDK:n asennuksesta ja <em>JAVA_HOME</em>:n asettamisesta ja komentorivin uudelleenkäynnistämisestä  huolimatta virheen <em>Could not find tools.jar</em>, tee projektiisi tiedosto <em>gradle.properties</em> ja määrittele sinne JDK:n sijainti seuraavaan tyyliin (polun kohdalle siis tulee oman koneesi JDK:n polku):</p>

  <pre>
org.gradle.java.home=C:\\Program Files\\Java\\jdk1.8.0_45
</pre>

  <p>Lisää tiedostoon <em>.gitignore</em> rivi</p>

  <pre>
gradle.properties
</pre>

  <p>Emme halua laittaa määrittelyä versionhallintaan asti, sillä kyseessä on konekohtainen asetus.</p>

  <p>Jos jouduit tekemään tämän ratkaisun, on todennäköistä, että joudut toimimaan samoin jatkossa kaikkien gradle-projektien kohdalla.</p>
</blockquote>

<p>Kun komento <code>./gradlew build</code> (Linux, OSX) tai <code>gradlew.bat build</code> (Windows) tai <code>gradle build</code> toimii, olet valmis siirtymään seuraavaan kohtaan.</p>

<p><strong>Tee nyt seuraavat toimenpiteet</strong>. Ohjeen kaikissa kohdissa komento on annettu muodossa <code>gradle toimenpide</code>, käytä sitä komennon muotoa joka toimii koneellasi, suositeltavinta on käyttää versiota <code>./gradlew</code>, näin varmistat että käytössäsi on uusin gradlen versio.</p>

<ul>
  <li>aloita nyt puhtaalta pöydältä komennolla <code>gradle clean</code>
    <ul>
      <li>käytä siis komennosta muotoa <code>./gradlew</code> jos <code>gradle</code> ei toimi</li>
    </ul>
  </li>
  <li>tee juuressa komento <code>tree</code></li>
  <li>käännä koodi: <code>gradle build</code>
    <ul>
      <li>tee jälleen juuressa komento tree. Mitä muutoksia huomaat?</li>
    </ul>
  </li>
  <li>suorita pääohjelma komennolla <code>gradle run</code></li>
  <li>tee <code>gradle clean</code>
    <ul>
      <li>suorita cleanin jälkeen tree-komento. Mitä clean tekee?</li>
    </ul>
  </li>
  <li>suorita testit komennolla <code>gradle test</code>
    <ul>
      <li>suorita jälleen komento <code>tree</code></li>
      <li>huomaat, että testien ajaminen luo hakemiston <em>build/reports/tests/test</em>. Testien diagnostiikka tulee tähän hakemistoon</li>
    </ul>
  </li>
  <li>avaa selaimella testien tuloksen raportoiva tiedosto <em>build/reports/tests/test/index.html</em></li>
</ul>

<p>Tehdään seuraavaksi projektista <a href="https://en.wikipedia.org/wiki/JAR_(file_format)">jar</a>-tiedosto, joka paketoi projektin käännetyn koodin yhdeksi tiedostoksi, joka voidaan suorittaa millä tahansa koneella, mille on asennettu java.</p>

<ul>
  <li>Lisää tiedostoon <em>build.gradle</em> seuraava:</li>
</ul>

<div class="language-groovy highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">jar</span> <span class="o">{</span>
    <span class="n">manifest</span> <span class="o">{</span>
        <span class="n">attributes</span> <span class="s1">'Main-Class'</span><span class="o">:</span> <span class="s1">'ohtu.ohtuvarasto.Main'</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>Lisätty konfiguraatio kertoo, mikä ohjelman luokista on ns. pääohjelma, eli sisältää metodin <em>main</em></p>

<ul>
  <li>generoi jar-tiedosto komennolla <code>gradle jar</code>
    <ul>
      <li>komennolla tree näet minne hakemistoon jar tulee</li>
    </ul>
  </li>
  <li>suorita jar-tiedosto komennolla <code>java -jar tiedoston_nimi.jar</code>
    <ul>
      <li>komento tulee suorittaa hakemistosta, jossa jar-tiedosto sijaitsee</li>
    </ul>
  </li>
  <li>voit nyt suorittaa ohjelman millä tahansa koneella kopioimalla jar-tiedoston koneelle ja suorittamalla edellä mainitun komennon.</li>
</ul>

<h3 id="8-junit">8. JUnit</h3>

<p>Ohjelmistokehityksen ehkä tärkein vaihe on laadunvarmistus, laadunvarmistuksen tärkein keino taas on testaus, joka on syytä automatisoida mahdollisimman pitkälle, sillä ohjelmistoja joudutaan testaamaan paljon. Erityisesti iteratiivisessa/ketterässä ohjelmistokehityksessä samat testit on suoritettava uudelleen aina ohjelman muuttuessa.</p>

<p>Java-maailmassa automatisoidun testaamisen johtava työkalu on JUnit, johton olet todennäköisesti jo tutustunut kurssilla Ohjelmistotekniikka.</p>
<ul>
  <li>Jos JUnit on vieras tai pääsyt unohtumaan kertaa perusteet kurssin Ohjelmistotekniikka <a href="https://github.com/mluukkai/Ohjelmistotekniikka-syksy-2019/blob/master/web/junit.md">JUnit-ohjeesta</a></li>
</ul>

<p>Edellisen tehtävän esimerkkisovelluksessa on jo jonkun verran JUnit-testejä, <strong>laajennetaan nyt testejä</strong>.</p>

<p><strong>HUOM</strong> tehtävässä käytettävä <em>jacoco</em>-plugin edellyttää toimiakseen gradlen versiota 5.6. Voit testata käyttämäsi version komennolla <em>gradle -v</em>.</p>

<p>Muista, että testit suoritetaan komennolla <code>gradle test</code></p>

<ul>
  <li>Täydennä Ohtuvaraston testejä siten, että luokan <em>Varasto</em> testien rivikattavuudeksi (line coverage) tulee 100%
    <ul>
      <li>joudut huomioimaan ainakin tapaukset, joissa varastoon yritetään laittaa liikaa tavaraa ja varastosta yritetään ottaa enemmän kuin siellä on</li>
      <li>edellinenkään ei vielä riitä</li>
    </ul>
  </li>
  <li>testauksen rivikattavuuden saat selville Gradlen <a href="https://docs.gradle.org/current/userguide/jacoco_plugin.html#gsc.tab=0">JaCoCo</a>-pluginin avulla</li>
  <li>ota plugin projektissasi käyttöön lisämäällä tiedostoon <em>build.gradle</em> seuraava rivi:
    <div class="language-groovy highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">apply</span> <span class="nl">plugin:</span> <span class="s2">"jacoco"</span> 
</code></pre></div>    </div>
    <p>ja suorittamalla komento <code>gradle test jacocoTestReport</code></p>
  </li>
  <li>näet html-muodossa olevean testien rivikattavuusraportin avaamalla selaimella tiedoston <em>build/reports/jacoco/test/html/index.html</em>
    <ul>
      <li>pääset klikkailemalla luokkien ja metodien nimiä näkemään mitkä rivit ovat vielä testien ulottumattomissa</li>
      <li><strong>HUOM</strong> jos jacoco aiheuttaa virheilmoituksen <em>Could not resolve all files for configuration ‘:jacocoAgent’.</em> , vaihda tiedostosta <em>build.gradle</em> merkkijono <em>jcenter()</em> muotoon <em>mavenCentral()</em></li>
      <li><strong>HUOM2</strong> jos gradle ilmoittaa <em>:jacocoTestReport SKIPPED</em>, suorita komento <code>gradle clean</code> ja yritä uudelleen.</li>
    </ul>
  </li>
  <li>kun luokan <code>Varasto</code> testien rivikattavuus (line coverage) on 100%, pushaa tekemäsi muutokset GitHubiin</li>
</ul>

<p><strong>HUOM</strong> tehtävässä käytettävä <em>jacoco</em>-plugin edellyttää toimiakseen gradlen versiota 5.6. Voit tarkistaa käyttämäsi version komennolla <em>gradle -v</em>. Cubbli-Linuxien oletusarvoinen versio on 4.4.1. ja sitä käyttäessä (eli komennolla <em>gradle</em>) jacoco ei toimi:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mluukkai@melkki:~/ohtu-2019-viikko1$ gradle test jacocoTestReport
Starting a Gradle Daemon (subsequent builds will be faster)

&gt; Task :test
Exception in thread "main" java.lang.reflect.InvocationTargetException
        at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
</code></pre></div></div>

<p>Komennolla <em>./gradlew</em> on käytössä projektin lokaali versio 5.6.3 ja sillä projekti toimii.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mluukkai@melkki:~/ohtu-2019-viikko1$ ./gradlew test jacocoTestReport

...

BUILD SUCCESSFUL in 16s
</code></pre></div></div>

<h3 id="9-circleci-osa-1">9. CircleCI, osa 1</h3>

<p>Gradlen avulla ohjelmiston käännös ja testien suorittaminen on mahdollista tehdä skriptattavaksi, eli komentoriviltä helposti suoritettavaksi. Käännöksen automatisoinnin jälkeen seuraava askel on suorittaa buildausprosessi, eli ohjelman kääntäminen ja siihen liittyvien testien suoritus, erillisillä <em>build-palvelimella</em> (engl. build server).</p>

<p>Ideana on, että ohjelmistokehittäjä noudattaa seuraavaa sykliä:</p>
<ul>
  <li>uusin versio koodista haetaan versionhallinnan keskitetystä repositoriosta ohjelmistokehittäjän työasemalle</li>
  <li>lisäykset ja niitä testaavat testit tehdään paikalliseen kopioon</li>
  <li>käännös ja testit ajetaan paikalliseen kopioon ohjelmistokehittäjän työasemalla</li>
  <li>jos kaikki on kunnossa, paikalliset muutokset lähetetään keskitettyyn repositorioon</li>
  <li>build-palvelin seuraa keskitettyä repositoriota ja kun siellä huomataan muutoksia, kääntää - käännöspalvelin koodin ja suorittaa sille testit</li>
  <li>build-palvelin raportoi havaituista virheistä</li>
</ul>

<p>Erillisen build-palvelimen avulla varmistetaan, että ohjelmisto toimii muuallakin kuin muutokset tehneen ohjelmistokehittäjän koneella. Tätä käytännettä kutsutaan <em>jatkuvaksi integraatioksi</em> (engl. continuous integration). Palaamme asiaan tarkemmin kurssin <a href="http://localhost:4000/osa3#jatkuva-integraatio">kolmannessa osassa</a></p>

<p>Kurssilla käytämme pilvessä toimivaa <a href="https://circleci.com/">CircleCI</a>-nimistä build-palvelinohjelmistoa.</p>

<p>Konfiguroidaan seuraavaksi Circle huolehtimaan projektistamme.</p>

<ul>
  <li>mene osoitteeseen <a href="https://circleci.com/">https://circleci.com/</a> ja valitse <em>Sign Up</em> ja <em>Sign Up with GitHub</em></li>
  <li>palvelu kysyy käyttölupia, tässä tapauksessa pääsy repositorioihin riittää.</li>
  <li>avaa palvelun vasemmassa reunasta “add project”-välilehti ja valitse “Set Up Project” repositorion vierestä</li>
</ul>

<p>Tästä aukeaa ohjeistus, seuraamme sitä, mutta hyppäämme 3. kohdan yli.</p>

<ul>
  <li>valitaan configuraatioksi Linux ja Gradle (Java)</li>
  <li>lisää repositoriosi juureen hakemisto nimeltään <em>.circleci</em>
    <ul>
      <li>huomaa, että nimen pitää alkaa pisteellä!</li>
    </ul>
  </li>
  <li>tee tiedosto <em>config.yml</em> kansion <em>.circleci</em> sisälle ja kopioi sinne CircleCI:n antama <em>Sample.yml</em>-tiedoston  sisältö</li>
  <li>commitoi ja pushaa repositorio GitHubiin</li>
  <li>paina <em>Start Building</em></li>
</ul>

<p>nyt Circle alkaa tarkkailla jokaista muutosta, jonka teet repositorioon.</p>

<ul>
  <li>sivulle avautuu näkymä, joka kertoo siitä, että Circle yrittää <em>buildata</em> koodin, jonka repositorio sisältää</li>
</ul>

<p><img src="http://localhost:4000/images/lh1-6.png" alt="" /></p>

<h3 id="10-circleci-osa-2">10. CircleCI, osa 2</h3>

<p>Mitä Circlessä oikeastaan tapahtuu?</p>

<ul>
  <li>Kun Circleen rekisteröity projekti pushataan GitHubiin, ilmoittaa GitHub-asiasta Circlelle</li>
  <li>CircleCI käynnistää <a href="https://www.docker.com/resources/what-container">Docker-kontin</a> (eri eräänlaisen virtuaalisen suoritusympäristön), jonne se kloonaa muuttuneen repositorion tekemällä komennon <em>git clone</em></li>
  <li>CircleCI lukee repositoriossa olevan konfiguraatiotiedoston <em>.circleci/config.yml</em> ja toimii tiedostossa olevien ohjeiden mukaan.</li>
  <li>Jos testit menevät läpi on Circlen buildin tila <em>Success</em>.</li>
</ul>

<p>Oletusarvoinen konfiguraatiotiedosto näyttää seuraavalta:</p>

<div class="language-yml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">version</span><span class="pi">:</span> <span class="s">2</span>
<span class="na">jobs</span><span class="pi">:</span>
  <span class="na">build</span><span class="pi">:</span>
    <span class="na">docker</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">image</span><span class="pi">:</span> <span class="s">circleci/openjdk:8-jdk</span>

    <span class="na">working_directory</span><span class="pi">:</span> <span class="s">~/repo</span>

    <span class="na">environment</span><span class="pi">:</span>
      <span class="na">JVM_OPTS</span><span class="pi">:</span> <span class="s">-Xmx3200m</span>
      <span class="na">TERM</span><span class="pi">:</span> <span class="s">dumb</span>

    <span class="na">steps</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">checkout</span>

      <span class="pi">-</span> <span class="na">restore_cache</span><span class="pi">:</span>
          <span class="na">keys</span><span class="pi">:</span>
            <span class="pi">-</span> <span class="s">v1-dependencies-</span>
            <span class="pi">-</span> <span class="s">v1-dependencies-</span>

      <span class="pi">-</span> <span class="na">run</span><span class="pi">:</span> <span class="s">gradle dependencies</span>

      <span class="pi">-</span> <span class="na">save_cache</span><span class="pi">:</span>
          <span class="na">paths</span><span class="pi">:</span>
            <span class="pi">-</span> <span class="s">~/.gradle</span>
          <span class="na">key</span><span class="pi">:</span> <span class="s">v1-dependencies-</span>

      <span class="pi">-</span> <span class="na">run</span><span class="pi">:</span> <span class="s">gradle test</span>
</code></pre></div></div>

<p><strong>HUOM</strong>: muuta skriptissä olevat <em>gradle</em>-komennot muotoon <em>./gradlew</em> jolloin Circle käyttää (oletusarvoisen Gradlen sijaan) projektiin määriteltyä Gradlea:</p>

<div class="language-yml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>      <span class="pi">-</span> <span class="na">run</span><span class="pi">:</span> <span class="s">./gradlew dependencies</span>
      <span class="s">...</span>
      <span class="pi">-</span> <span class="na">run</span><span class="pi">:</span> <span class="s">./gradlew test</span>
</code></pre></div></div>

<p>Kohdan <em>build</em> alla määritellään ensin suoritusympäristö (<em>docker</em> ja <em>environment</em>) ja sen jälkeen <em>steps</em> eli mitä toimenpiteitä tarkkailun alla olevalle koodille tehdään. Tärkeimmät askeleet ovat <em>checkout</em>, joka kloonaa projektin koodin, <em>run: gradle dependencies</em>, joka lataa projektin tarvitsemat kirjastot sekä <em>run: gradle test</em>, joka suorittaa testit.</p>

<p>Klikkaamalla buildin tilaa kertovaa vihreää tai punaista palkkia pääset katsomaan tarkemmin mitä kussakin käännösprosessin askeleessa eli stepissä tapahtuu:</p>

<p><img src="http://localhost:4000/images/lh1-7.png" alt="" /></p>

<p>CircleCI-buildien toimintaa onkin mahdollista <a href="https://circleci.com/docs/2.0/configuration-reference/">konfiguroida</a> melko vapaasti.</p>

<ul>
  <li>Muuta nyt jotain testiä siten, että testi ei mene läpi ja pushaa koodi GitHubiin</li>
  <li>Tarkkaile projektin CircleCI <em>jobs</em>-näkymää. Lisätiedot avautuvat painamalla punaista “Failed” painiketta. Lue näkymään alaosassa avautuva loki kokonaisuudessaan läpi.</li>
  <li>Korjaa testi ja pushaa muutokset uudelleen GitHubiin</li>
  <li>Tarkkaile jälleen CircleCI-näkymää ja lue loki läpi</li>
</ul>

<h3 id="11-circleci-osa-3">11. CircleCI, osa 3</h3>

<p>Laita repositiossa olevaan tiedostoon <em>README.md</em> koodin tilasta kertova <a href="https://circleci.com/docs/2.0/status-badges/">Status Badge</a>. Avaa ensin asetussivu saa <em>jobs</em>-näkymästä:</p>

<p><img src="http://localhost:4000/images/lh1-8.png" alt="" /></p>

<p>ja kopioi badgen määrittelevä markdown-koodi</p>

<p><img src="http://localhost:4000/images/lh1-9.png" alt="" /></p>

<p>Editoi tiedostoa README.md suoraan GitHubissa:</p>

<p><img src="http://localhost:4000/images/lh1-10.png" alt="" /></p>

<p>Tee nyt jokin muutos koneellasi repositorioon ja yritä pushata koodi GitHubiin. Toimenpiteestä seuraa virhe:</p>

<pre>
To github.com:mluukkai/ohtu-2019-viikko1.git
 ! [rejected]        master -&gt; master (fetch first)
error: failed to push some refs to 'git@github.com:mluukkai/ohtu-2019-viikko1.git'
hint: Updates were rejected because the remote contains work that you do
hint: not have locally. This is usually caused by another repository pushing
hint: to the same ref. You may want to first integrate the remote changes
hint: (e.g., 'git pull ...') before pushing again.
hint: See the 'Note about fast-forwards' in 'git push --help' for details.
</pre>

<p>Tulet todennäköisesti törmäämään vastaavaan virheeseen usein. Syynä virheelle on se, että yrität pushata muutoksia GitHubiin vaikka GitHub on “edellä” paikallista repositorioasi (ts. sinne lisättiin tiedosto README.md).</p>

<p>Ongelma ratkeaa, kun teet ensin komennon <code>git pull</code> ja pushaat koodin vasta sen jälkeen.</p>

<p>Pullauksen yhteydessä syntyy ns. merge commit ja git avaa oletuseditorisi ja haluaa että määrittelet commit messagen. Jos et ole muuttanut gitin käyttämää oletuseditoria, on käytössä <em>vim</em> joka toimii hieman erilaisilla periaatteilla kuin monet muut editorit. Joudut ehkä googlaamaan että pääset vimistä ulos…</p>

<h3 id="12-codecov">12. Codecov</h3>

<p>Tehtävässä 8 määrittelimme projektin testauskattavuuden <em>JaCoCo:n</em> avulla. https://codecov.io -palvelu mahdollistaa projektien koodikattavuuden julkaisemisen verkossa.</p>

<ul>
  <li>kirjaudu <a href="https://codecov.io">Codecoviin</a> (GitHub sign up)</li>
  <li>lisää repositorio Codecoviin alaisuuteen:</li>
</ul>

<p><img src="http://localhost:4000/images/lh1-12.png" alt="" /></p>

<p>Saat Codecov:in tarkkailemaan projektisi koodikattavuutta lisäämällä tiedoston <em>build.gradle</em> loppuun seuraava:</p>

<div class="language-groovy highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">jacocoTestReport</span> <span class="o">{</span>
    <span class="n">reports</span> <span class="o">{</span>
        <span class="n">xml</span><span class="o">.</span><span class="na">enabled</span> <span class="kc">true</span>
        <span class="n">html</span><span class="o">.</span><span class="na">enabled</span> <span class="kc">true</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>Sekä lisäämällä tiedoston <code>.circleci/config.yml</code> loppuun seuraavat rivit:</p>

<div class="language-yml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="pi">-</span> <span class="na">run</span><span class="pi">:</span> <span class="s">./gradlew check</span>
  <span class="pi">-</span> <span class="na">run</span><span class="pi">:</span> <span class="s">./gradlew jacocoTestReport</span>
  <span class="pi">-</span> <span class="na">run</span><span class="pi">:</span> <span class="s">bash &lt;(curl -s https://codecov.io/bash)</span>
</code></pre></div></div>

<p><strong>HUOM1</strong> rivit on sisennettävä samalle tasolle kuin muut <em>run</em>-komennot.</p>

<p><strong>HUOM2</strong> et tarvitse Codecovin tarjoamaa <em>upload tokenia</em> mihinkään:</p>

<p><img src="http://localhost:4000/images/lh1-13.png" alt="" /></p>

<p>Kun seuraavan kerran pushaamme koodin Githubiin, ilmestyy Codecov:iin koodin testikattavuusraportti:</p>

<p><img src="http://localhost:4000/images/lh1-14.png" alt="" /></p>

<p>Klikkaailemalla sivun alalaidassa olevasta kohdasta <em>Files</em> tiedostojen nimiä, pääset katsomaan yksittäisten luokkien testauksen kattamat rivit:</p>

<p><img src="http://localhost:4000/images/lh1-15.png" alt="" /></p>

<p>Käytännössä pyydämme Circleä suorittamaan onnistuneen buildin (eli komennon <code>gradle check</code>) jälkeen gradle-komennon, joka ensin suorittaa testien kattavuusanalyysin JaCoCo:lla ja sen jälkeen lähettää tiedot Codecoviin.</p>

<p>Pushaa nyt muutokset GitHubiin ja seuraa <em>sekä</em> CircleCI-buildin lokia, että repositorion Codecov-sivua.</p>

<p>Lisää projektin <em>readme badge</em> repositoriosi README.md-tiedostoon. Löydät badgen Codecovin settings-valikosta.</p>

<p>Projektisi GitHub-sivun tulisi lopulta näyttää suunnilleen seuraavalta (poislukien liian alhainen testauskattvuus):</p>

<p><img src="http://localhost:4000/images/lh1-16.png" alt="" /></p>

<p>Huomaa, että CircleCIn ja Codecovin badget eivät päivity täysin reaaliajassa. Eli vaikka projektin testikattavuus nousisi, kestää hetken, ennen kuin badge näyttää tuoreen tilanteen.</p>

<h3 id="13-parempi-testauskattavuus">13. Parempi testauskattavuus</h3>

<p>Projektin testauskattavuutta häiritsee nyt se, että myös pääohjelma <em>Main</em> lasketaan testikattavuuteen.</p>

<p>Voimme määritellä, että joidenkin pakkausten sisältö jätetään huomioimatta kattavuusraportin generoinnissa.</p>

<p>Luo projektiin uusi pakkaus nimeltä <em>main</em> samalle tasolle kuin <em>ohtu</em>, siirrä pääohjelma luomaasi pakkaukseen ja muuta <em>build.gradle</em>:n <em>jacocoTestReport</em> muotoon:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>jacocoTestReport {
    reports {
        xml.enabled true
        html.enabled true
    }
    afterEvaluate {
        classDirectories.setFrom(files(classDirectories.files.collect {
            fileTree(dir: it,
                    exclude: ['main/**'])
        }))
    }
}
</code></pre></div></div>

<p>Muuta myös saman tiedoston muut viitteet pääohjelmaan oikeaan muotoon ja varmista, että 
<a href="/tehtavat1#7-gradle">tehtävässä 7</a> mainitut ohjelman suoritus komennolla <em>gradle run</em> ja generoidun jar-tiedoston suorittaminen edelleen toimivat.</p>

<p>Pushaa koodi Githubiin ja varmista, että Codecov generoi raportin siten, että <em>Main</em> jätetään huomioimatta.</p>

<h3 id="tehtävien-palautusrepositoriot">Tehtävien palautusrepositoriot</h3>

<p>Tehtävät 14-16 kannattaa tehdä <em>eri repositorioon</em> kuin mihin teit tehtävät 2-13. Voit käyttää tehtävien 14-16 repositoriota myös seuraavien viikkojen tehtävien palauttamiseen. Nyt  tehtävän repositorion rakenne voi tällöin olla esim. seuraava:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>viikko1
  tehtavat14-16
viikko2
  tehtavat1-4
  tehtavat5-7
viikko3
   tehtavat1-2
   tehtava3
   tehtavat7-11
...
</code></pre></div></div>

<p>Lisää tehtäviin 2-13 käyttämäsi repositorion README.md-tiedostoon linkki tehtävien 14-16 palautusrepositorioosi.</p>

<p>Tehtävien 2-13 repositorion README.md-tiedoston tulisi siis näyttää suunnilleen tältä</p>

<p><img src="http://localhost:4000/images/lh1-11.png" alt="" /></p>

<h3 id="14-riippuvuuksien-injektointi-osa-1">14. riippuvuuksien injektointi osa 1</h3>

<p>Tutustumme kurssin aikana muutamiin <em>suunnittelumalleihin</em> (engl. design pattern), eli hyviksi tunnettuihin useisiin erilaisiin tilanteisiin sopiviin ratkaisutapoihin, joiden soveltaminen usein parantaa koodin laatua.</p>

<p>Kurssin ensimmäinen suunnittelumalli <em>riippuvuuksien injektointi</em> (engl. dependency injection), on yksinkertainen periaate, jota noudattamalla koodin automatisoitua testaamista on monissa tilanteissa mahdollista helpottaa ratkaisevalla tavalla.</p>

<ul>
  <li>Tutustu riippuvuuksien injektointiin lukemalla <a href="/riippuvuuksien_injektointi/">tämä dokumentti</a></li>
  <li>hae esimerkkiprojekti kurssin <a href="https://github.com/ohjelmistotuotanto-hy/syksy2019">tehtävärepositorion</a> hakemistosta <a href="https://github.com/ohjelmistotuotanto-hy/syksy2019/tree/master/koodi/viikko1/RiippuvuuksienInjektointi1">koodi/viikko1/RiippuvuuksienInjektointi1</a> ja kokeile että se toimii
    <ul>
      <li>järkevintä lienee että kloonaat repositorion paikalliselle koneellesi</li>
      <li><strong>tämän jälkeen kannattaa kopioida projekti tehtävien 14-16 palautukseen käyttämäsi repositorion sisälle</strong></li>
    </ul>
  </li>
</ul>

<p>Tutustu riippuvuuksien injektointiin esimerkin avulla. Saat suoritettua koodin komennolla <em>gradle run</em>. Jos haluat suorittaa koodin ilman gradlen välitulostuksia, anna komento muodossa <em>gradle -q –console plain run</em></p>

<h3 id="15-riippuvuuksien-injektointi-osa-2-nhl-tilastot">15. riippuvuuksien injektointi osa 2: NHL-tilastot</h3>

<ul>
  <li>Kurssin kurssin <a href="https://github.com/ohjelmistotuotanto-hy/syksy2019">tehtävärepositorion</a> hakemistossa <a href="https://github.com/ohjelmistotuotanto-hy/syksy2019/tree/master/koodi/viikko1/NhlStatistics1">koodi/viikko1/NHLStatistics1</a> on ohjelma, jonka avulla on mahdollista tutkia <a href="https://nhl.com">https://nhl.com</a>-sivulla olevia, kuluvan kauden tilastotietoja
    <ul>
      <li>Kopioi projekti edellisen tehtävän repositorion alle omaksi hakemistoksi</li>
    </ul>
  </li>
  <li>Ohjelma koostuu kolmesta luokasta.
    <ul>
      <li><code>Statistics</code> on palvelun tarjoava luokka, se tarjoaa metodit yhden pelaajan tietojen näyttämiseen, pistepörssin näyttämiseen ja yhden joukkueen pelaajien tietojen näyttämiseen</li>
      <li><code>Player</code>  on luokka, jonka olioina Statistics käsittelee yksittäisen pelaajan tietoja</li>
      <li><code>PlayerReader</code>  on luokka, jonka avulla ohjelma käy hakemassa pelaajien tiedot internetistä</li>
    </ul>
  </li>
  <li>Ohjelma on nyt ikävästi struktoroitu ja esim. yksikkötestaus on kovin hankalaa</li>
  <li><strong>HUOM:</strong> kun suoritat koodin ensimmäisen kerran (komennolla <em>gradle run</em>), saattaa kestää hetken ennen kuin ohjelman käyttämä palvelin herää. Seuraavat suorituskerrat ovat nopeampia.</li>
</ul>

<p><strong>Itse tehtävä:</strong></p>

<ul>
  <li>Määrittele rajapinta <code>Reader</code>, jolla on samat julkiset metodit kuin PlayerReaderilla, eli ainoastaan metodi <code>getPlayers()</code>. Laita PlayerReader toteuttamaan rajapinta.
    <ul>
      <li>HUOM: NetBeansissa on automaattinen refaktorointiominaisuus, jonka avulla luokasta saa helposti generoitua rajapinnan, jolla on samat metodit kuin luokalla. Klikkaa luokan kohdalla hiiren oikeaa nappia, valitse refactor ja “extract interface”</li>
    </ul>
  </li>
  <li>Muokkaa ohjelman rakennetta siten, että Statictics saa konstruktoriparametrina <code>Reader</code>-tyyppisen olion.</li>
  <li>Muokkaa pääohjelma siten, että se injektoi Statistics-oliolle PlayerReaderin ja kokeile että ohjelma toimii edelleen:</li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">Statistics</span> <span class="n">stats</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Statistics</span><span class="o">(</span> <span class="k">new</span> <span class="n">PlayerReader</span><span class="o">(</span><span class="s">"https://nhlstatisticsforohtu.herokuapp.com/players.txt"</span><span class="o">)</span> <span class="o">);</span>
</code></pre></div></div>

<h3 id="16-nhlstatistics-ohjelman-yksikkötestaus">16. NHLStatistics-ohjelman yksikkötestaus</h3>

<ul>
  <li>tee yksikkötestit luokalle Statistics
    <ul>
      <li>testien kattavuuden (sekä instructions että branches) tulee Statistics-luokan osalta olla 100% (mittaa kattavuus JaCoCo:lla, ks. <a href="/tehtavat1#8-junit">tehtävä 8</a>)</li>
      <li>testit eivät saa käyttää verkkoyhteyttä</li>
      <li>verkkoyhteyden tarpeen saat eliminoitua luomalla testiä varten rajapinnan Reader-toteuttavan “stubin”, jonka sisälle kovakoodaat palautettavan pelaajalistan</li>
      <li>voit luoda stubin testin sisälle anonyyminä sisäluokkana seuraavasti:</li>
    </ul>
  </li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">StatisticsTest</span> <span class="o">{</span>
 
    <span class="n">Reader</span> <span class="n">readerStub</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Reader</span><span class="o">()</span> <span class="o">{</span>
 
        <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Player</span><span class="o">&gt;</span> <span class="nf">getPlayers</span><span class="o">()</span> <span class="o">{</span>
            <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">Player</span><span class="o">&gt;</span> <span class="n">players</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;();</span>
 
            <span class="n">players</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="n">Player</span><span class="o">(</span><span class="s">"Semenko"</span><span class="o">,</span> <span class="s">"EDM"</span><span class="o">,</span> <span class="mi">4</span><span class="o">,</span> <span class="mi">12</span><span class="o">));</span>
            <span class="n">players</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="n">Player</span><span class="o">(</span><span class="s">"Lemieux"</span><span class="o">,</span> <span class="s">"PIT"</span><span class="o">,</span> <span class="mi">45</span><span class="o">,</span> <span class="mi">54</span><span class="o">));</span>
            <span class="n">players</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="n">Player</span><span class="o">(</span><span class="s">"Kurri"</span><span class="o">,</span>   <span class="s">"EDM"</span><span class="o">,</span> <span class="mi">37</span><span class="o">,</span> <span class="mi">53</span><span class="o">));</span>
            <span class="n">players</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="n">Player</span><span class="o">(</span><span class="s">"Yzerman"</span><span class="o">,</span> <span class="s">"DET"</span><span class="o">,</span> <span class="mi">42</span><span class="o">,</span> <span class="mi">56</span><span class="o">));</span>
            <span class="n">players</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="n">Player</span><span class="o">(</span><span class="s">"Gretzky"</span><span class="o">,</span> <span class="s">"EDM"</span><span class="o">,</span> <span class="mi">35</span><span class="o">,</span> <span class="mi">89</span><span class="o">));</span>
 
            <span class="k">return</span> <span class="n">players</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">};</span>
 
    <span class="n">Statistics</span> <span class="n">stats</span><span class="o">;</span>

    <span class="nd">@Before</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setUp</span><span class="o">(){</span>
        <span class="c1">// luodaan Statistics-olio joka käyttää "stubia"</span>
        <span class="n">stats</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Statistics</span><span class="o">(</span><span class="n">readerStub</span><span class="o">);</span>
    <span class="o">}</span>  
<span class="o">}</span>
</code></pre></div></div>

<p>Kun injektoit readerStub-olion testissä Statistics-oliolle, palauttaa se aina saman pelaajalistan.</p>

<h3 id="tehtävien-palautus">Tehtävien palautus</h3>

<p>Pushaa kaikki tekemäsi tehtävät (paitsi ne joissa mainitaan, että tehtävää ei palauteta mihinkään) GitHubiin ja merkkaa tekemäsi tehtävät palautussovellukseen <a href="https://study.cs.helsinki.fi/stats/courses/ohtu-avoin-2020">https://study.cs.helsinki.fi/stats/courses/ohtu-avoin-2020</a></p>

  </div>

</article>
      </div>
    </main>

     <footer class="site-footer">

  <div class="wrapper">

    <h2 class="footer-heading"></h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li>
             Ohjelmistotuotanto avoin yliopisto 2020 
          </li>
          <li>
            <a href="mailto:matti.luukkainen@helsinki.fi">matti.luukkainen@helsinki.fi</a>
          </li>
          <li>
            <a href="https://github.com/mluukkai"><span class="icon icon--github"><svg viewBox="0 0 16 16" width="16px" height="16px"><path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/></svg>
</span><span class="username">mluukkai</span></a>

          </li>
        </ul>
      </div>

      <div class="footer-col footer-col-2">
        <ul class="social-media-list">
           
        </ul>
      </div>

      <div class="footer-col footer-col-3">
          <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/3.0/">
            <img alt="Creative Commons -lisenssi" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-sa/3.0/88x31.png"
            />
          </a>
          <br/> Materiaali on lisensoitu
          <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/3.0/">Creative Commons BY-NC-SA 3.0 -lisenssillä</a>.
      </div>
    </div>

  </div>

</footer>
  
  </body>

</html>
